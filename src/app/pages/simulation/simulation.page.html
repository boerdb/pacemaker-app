<ion-header class="ion-no-border">
  <ion-toolbar>

    <ion-buttons slot="start">
      <ion-back-button defaultHref="/dashboard"></ion-back-button>
    </ion-buttons>

    <ion-title>Pacemaker Simulator</ion-title>

    <ion-buttons slot="end">

      <!-- Realism toggle -->
      <ion-button (click)="realismMode = !realismMode">
        <ion-icon
          [name]="realismMode ? 'flask' : 'flask-outline'"
          [color]="realismMode ? 'warning' : 'medium'">
        </ion-icon>
      </ion-button>

      <!-- Pause / Play -->
      <ion-button (click)="toggleRun()" color="light">
  <ion-icon
    [name]="isRunning ? 'pause' : 'play'">
  </ion-icon>
</ion-button>

    </ion-buttons>

  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <div class="monitor-frame">

    <div class="monitor-label">
  LEAD I — {{ mode }}
  <span class="status-tag" *ngIf="realismMode">SIM+</span>
  <span class="status-tag paused" *ngIf="!isRunning">PAUSE</span>
</div>


    <div *ngIf="eventLabel" class="event-overlay">
      {{ eventLabel }}
    </div>

    <div class="canvas-container">
      <canvas #ecgCanvas></canvas>
    </div>

  </div>

  <!-- RATE -->
  <div class="pm-card">
    <div class="pm-row">
      <span class="pm-label">Lower Rate Limit</span>
      <span class="pm-value">{{ bpm }} ppm</span>
    </div>
    <ion-range min="30" max="120" step="5" [(ngModel)]="bpm"></ion-range>
  </div>

  <!-- OUTPUT -->
  <div class="pm-card">
    <div class="pm-row">
      <span class="pm-label">Output</span>
      <span class="pm-value">{{ output }} mA</span>
    </div>
    <ion-range min="0" max="10" step="0.5" [(ngModel)]="output"></ion-range>
  </div>

  <!-- SENSITIVITY -->
  <div class="pm-card">
    <div class="pm-row">
      <span class="pm-label">Sensitivity</span>
      <span class="pm-value">{{ sensitivity }} mV</span>
    </div>
    <ion-range min="0.5" max="5" step="0.1" [(ngModel)]="sensitivity"></ion-range>
  </div>

  <!-- THRESHOLD TEST -->
  <div class="pm-card-interactive action-button"
       (click)="toggleThresholdTest()"
       [style.border-color]="isTesting ? 'var(--ion-color-danger)' : 'var(--pm-color-atrium)'">

    <ion-icon [name]="isTesting ? 'square' : 'pulse'"
              [class.beat-anim]="isTesting"></ion-icon>

    <div>
      <b *ngIf="!isTesting">Start Capture Threshold Test</b>
      <b *ngIf="isTesting" style="color: var(--ion-color-danger);">
        STOP TEST ({{ output }} V)
      </b>
      <br>
      <small *ngIf="!isTesting">Output wordt automatisch verlaagd</small>
      <small *ngIf="isTesting">Test loopt… kijk naar ECG</small>
    </div>

  </div>

</ion-content>
